<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="도전하고 싶으신가요? 피버타임과 함께하세요 !!">

    <!-- title -->
    <title>피버타임</title>

    <!-- bootstrap css-->
    <!-- favicon -->
    <link rel="shortcut icon" type="image/png"
          href="./static/assets/img/favicon.svg">
    <!-- google font -->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Poppins:400,700&display=swap" rel="stylesheet">
    <!-- fontawesome -->
    <link rel="stylesheet" href="./static/assets/css/all.min.css">
    <!-- bootstrap -->
    <link rel="stylesheet" href="./static/assets/bootstrap/css/bootstrap.min.css">
    <!-- owl carousel -->
    <link rel="stylesheet" href="./static/assets/css/owl.carousel.css">
    <!-- magnific popup -->
    <link rel="stylesheet" href="./static/assets/css/magnific-popup.css">
    <!-- animate css -->
    <link rel="stylesheet" href="./static/assets/css/animate.css">
    <!-- mean menu css -->
    <link rel="stylesheet" href="./static/assets/css/meanmenu.min.css">
    <!-- main style -->
    <link rel="stylesheet" href="./static/assets/css/main.css">
    <!-- responsive -->
    <link rel="stylesheet" href="./static/assets/css/responsive.css">

    <!-- jquery -->
    <script src="./static/assets/js/jquery-1.11.3.min.js"></script>

    <!-- kakao login-->
    <script src="https://developers.kakao.com/sdk/js/kakao.js"></script>
    <script src="static/assets/js/kakao-login.js"></script>

    <style>
        .btn {
            color: white;
        }

        .product-image img {
            width: 250px;
            height: 200px;
        }
    </style>
    <script>
        let userOwn = localStorage.getItem('username');

        $(document).ready(function () {
            loginStatus();
            getAllRooms();

            $.ajaxSetup({
                error: function (jqXHR, exception) {
                    switch (jqXHR.status) {
                        case 401:
                            alert('로그인을 해주세요.');
                            break;
                    }
                }
            });
        })


        //로그인되어있을때는 로그아웃 버튼 보이기
        function loginStatus() {
            if (localStorage.getItem("token") == null) {
                $('#logout').hide();
                $('#login').show();
            } else {
                $('#login').hide();
                $('#logout').show();
            }
        }

        function logout() {
            localStorage.removeItem("token");
            location.href = "index.html";
        }

        function onClickMyPage() {
            if (localStorage.getItem("token") == null) {
                alert("로그인을 해주세요!");
            } else {
                location.href = "user.html";
            }
        }

        //채팅 방 참가하기
        function joinRoom(idx) {
            if (localStorage.getItem("token") == null) {
                alert("로그인 후 참가해주세요 !!")
            } else {
                console.log(idx)
                window.location.href = `room-detail.html?roomId=${idx}`
            }
        }

        //채팅방 리스트 조회
        function getAllRooms() {
            $.ajax({
                    type: "GET",
                    url: `https://api.fevertime.shop/chat/rooms`,
                    contentType: 'application/json; charset=utf-8',
                    success: function (response) {
                        console.log(response)
                        let all_rooms = response;
                        for (let i = 0; i < all_rooms.length; i++) {
                            let idx = all_rooms[i]['roomId'];
                            let name = all_rooms[i]['name'];
                            let date = all_rooms[i]['createdDate']
                            let creator = all_rooms[i]['creator']

                                let temp_html = `<div class="card border-dark mb-3"
                                 style="max-width: 18rem;margin-left: 100px;margin-top: 50px;width: 250px;height: 215px">
                                <div class="card-header">개설일 : ${date}</div>
                                <div class="card-body text-dark">
                                    <h5 class="card-title">${name}</h5>
                                    <p class="card-text">참여인원 : 0명</p>
                                    <button type="button" class="btn" style="background-color: #F28123;border-color: #F28123"
                                            onclick="joinRoom(${idx})">참가하기
                                    </button>
                                </div>
                            </div>`;
                                $('#room-list').append(temp_html)
                        }
                    }
                }
            )
        }

        //채팅방 개설
        function createRoom() {
            let name = $('#room_name').val()
            if (name !== "") {
                $.ajax({
                    type: "POST",
                    url: `https://api.fevertime.shop/chat/room`,
                    contentType: "application/json",
                    data: JSON.stringify(name),
                    beforeSend: function (xhr) {
                        xhr.setRequestHeader('Authorization', 'Bearer ' + localStorage.getItem('token'));
                    },
                    success: function (response) {
                        alert(response['msg']);
                        window.location.reload();
                    }
                });
            } else {
                alert("채팅방 이름을 입력하세요");
            }
        }
    </script>
</head>
<body>
<!--PreLoader start -->
<div class="loader">
    <div class="loader-inner">
        <div class="circle"></div>
    </div>
</div>
<!--PreLoader end-->

<!-- header start -->
<div class="top-header-area" id="sticker">
    <div class="container">
        <div class="row">
            <div class="col-lg-12 col-sm-12 text-center">
                <div class="main-menu-wrap">
                    <!-- logo -->
                    <div class="site-logo" style="padding: 0;">
                        <a href="index.html">
                            <img src="./static/assets/img/logo.png" alt="">
                        </a>
                    </div>
                    <!-- logo -->

                    <!-- menu start -->
                    <nav class="main-menu">
                        <ul>
                            <li>
                                <a href="index.html">Home</a>
                            </li>
                            <li>
                                <a href="feed.html">Feed</a>
                            </li>
                            <li class="current-list-item">
                                <a href="chat.html">Chat</a>
                            </li>
                            <li>
                                <a href="#" style="margin-right: 150px">User</a>
                                <ul class="sub-menu">
                                    <li><a href="#" onclick="onClickMyPage()">My Page</a></li>
                                    <li id="login"><a href="#" data-toggle="modal"
                                                      data-target="#exampleModal">Login</a></li>
                                    <li id="logout"><a href="#" onclick="logout()">Logout</a></li>
                                </ul>
                            </li>

                            <li>
                                <div class="header-icons">
                                    <a class="mobile-hide search-bar-icon" href="#">
                                        <i class="fas fa-search"></i>
                                    </a>
                                </div>
                            </li>
                        </ul>
                    </nav>
                    <a class="mobile-show search-bar-icon" href="#"><i class="fas fa-search"></i></a>
                    <div class="mobile-menu"></div>
                    <!-- menu end -->
                </div>
            </div>
        </div>
    </div>
</div>
<!-- header end -->

<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Login</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" style="">
                <img onclick="loginWithKakao()" style="cursor:pointer;"
                     src="static/assets/img/kakao_login_large_wide.png" alt="카카오 로그인"/>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- search area start-->
<div class="search-area">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <span class="close-btn"><i class="fas fa-window-close"></i></span>
                <div class="search-bar">
                    <div class="search-bar-tablecell">
                        <h3>Search For:</h3>
                        <input type="text" id="search-input" placeholder="Keywords" name="search">
                        <button type="submit" onclick="getSearchChallenges()">Search <i class="fas fa-search"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- search area end -->

<!-- breadcrumb-section start -->
<div class="breadcrumb-section breadcrumb-bg">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 offset-lg-2 text-center">
                <div style="cursor: pointer;" onclick="location.href='index.html'" class="breadcrumb-text">
                    <p>습관, 목표 관리 애플리케이션</p>
                    <h1>피버타임</h1>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- breadcrumb section end -->

<!-- features list section -->
<div class="list-section" style="padding: 60px">
    <div class="container">
        <h4 style="margin-bottom: 40px">채팅방 개설</h4>
        <div class="input-group mb-3">
            <input id="room_name" type="text" class="form-control" placeholder="개설 할 채팅 방의 이름을 입력하세요."
                   aria-label="Recipient's username" aria-describedby="basic-addon2"
                   style="height: 49.5px;">
            <div class="input-group-append">
                <button class="btn btn-outline-secondary" type="button" onclick="createRoom()" style="color: black">
                    만들기
                </button>
            </div>
        </div>

    </div>
</div>
<!-- end features list section -->

<!-- products -->
<div class="product-section mb-150">
    <div class="container" style="text-align: center;height: 100%; min-height: 400px">
        <div class="row" id="room-list">

        </div>
    </div>
    <!-- end products -->

    <!-- copyright start -->
    <div class="copyright">
        <div class="container">
            <div class="row">
                <div class="col-lg-6 col-md-12">
                    <p>Copyrights &copy; 2021 - 피버타임, All Rights
                        Reserved.
                    </p>
                    <!--                <a href="https://imransdesign.com/">Imran Hossain</a> -->
                </div>
                <div class="col-lg-6 text-right col-md-12">
                    <div class="social-icons">
                        <!-- <ul>
                            <li><a href="#" target="_blank"><i class="fab fa-facebook-f"></i></a></li>
                            <li><a href="#" target="_blank"><i class="fab fa-twitter"></i></a></li>
                            <li><a href="#" target="_blank"><i class="fab fa-instagram"></i></a></li>
                            <li><a href="#" target="_blank"><i class="fab fa-linkedin"></i></a></li>
                            <li><a href="#" target="_blank"><i class="fab fa-dribbble"></i></a></li>
                        </ul> -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- copyright end -->

    <!-- bootstrap js start -->
    <!-- jquery -->
    <script src="./static/assets/js/jquery-1.11.3.min.js"></script>
    <!-- bootstrap -->
    <script src="./static/assets/bootstrap/js/bootstrap.min.js"></script>
    <!-- count down -->
    <script src="./static/assets/js/jquery.countdown.js"></script>
    <!-- isotope -->
    <script src="./static/assets/js/jquery.isotope-3.0.6.min.js"></script>
    <!-- waypoints -->
    <script src="./static/assets/js/waypoints.js"></script>
    <!-- owl carousel -->
    <script src="./static/assets/js/owl.carousel.min.js"></script>
    <!-- magnific popup -->
    <script src="./static/assets/js/jquery.magnific-popup.min.js"></script>
    <!-- mean menu -->
    <script src="./static/assets/js/jquery.meanmenu.min.js"></script>
    <!-- sticker js -->
    <script src="./static/assets/js/sticker.js"></script>
    <!-- main js -->
    <script src="./static/assets/js/main.js"></script>
    <!-- bootstrap js end -->
</body>
</html>